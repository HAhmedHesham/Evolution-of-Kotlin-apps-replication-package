/*!
 * @sie/designkit
 * @copyright     2021 Sony Interactive Entertainment LLC, all rights reserved
 */

!function(){"use strict";var e=function(e){if(!e||"false"===e)return null;if(e.startsWith("#"))return e;var t=/^rgba\(/.test(e);e=e.substring(t?5:4).split(")")[0].split(e.indexOf(",")>-1?",":" ");var n=(+e[0]).toString(16),a=(+e[1]).toString(16),i=(+e[2]).toString(16);if(n=1==n.length?"0"+n:n,a=1==a.length?"0"+a:a,i=1==i.length?"0"+i:i,!t)return"#"+n+a+i;var o=Math.round(255*+e[3]).toString(16);return o=1==o.length?"0"+o:o,"#"+n+a+i+o},t=function(e){var t=e.length>7;return(t?e.substring(0,7):e)+"00"},n=function(n,a,i,o,r,s){var d=n.data(a)||"";if(d){var c={};d=e(d),o&&(c={"--gradient-start-color":d,"--gradient-end-color":t(d)}),r&&(c["--gradient-start-color-tablet"]=d,c["--gradient-end-color-tablet"]=t(d)),s&&(c["--gradient-start-color-desktop"]=d,c["--gradient-end-color-desktop"]=t(d)),i&&(c[i]=d),n.css(c)}},a={IS_PORTRAIT:(window.matchMedia&&matchMedia("(orientation: portrait)")||{}).matches,IS_LANDSCAPE:(window.matchMedia&&matchMedia("(orientation: landscape)")||{}).matches,IS_MOBILE:(window.matchMedia&&matchMedia("(max-width: 767px)")||{}).matches,IS_MOBILE_PORTRAIT:(window.matchMedia("(max-width: 767px) and (orientation: portrait)")||{}).matches,IS_TABLET:(window.matchMedia&&matchMedia("(min-width: 768px)")||{}).matches,IS_DESKTOP:(window.matchMedia&&matchMedia("(min-width: 1024px)")||{}).matches},i=({IS_PORTRAIT:(window.matchMedia&&matchMedia("(orientation: portrait)")||{}).matches,IS_LANDSCAPE:(window.matchMedia&&matchMedia("(orientation: landscape)")||{}).matches,IS_JETSTREAM_MOBILE:(window.matchMedia&&matchMedia("(max-width: 699px)")||{}).matches,IS_MOBILE:(window.matchMedia&&matchMedia("(max-width: 767px)")||{}).matches,IS_MOBILE_PORTRAIT:(window.matchMedia("(max-width: 767px) and (orientation: portrait)")||{}).matches,IS_TABLET:(window.matchMedia&&matchMedia("(min-width: 768px)")||{}).matches,IS_TABLET_LG:(window.matchMedia&&matchMedia("(min-width: 1024px)")||{}).matches,IS_LAPTOP:(window.matchMedia&&matchMedia("(min-width: 1367px)")||{}).matches,IS_DESKTOP:(window.matchMedia&&matchMedia("(min-width: 1920px)")||{}).matches},{EMPTY_LABEL:"empty"}),o=/^(https?\:)?(\/{2})(store\.(playstation|sonyentertainmentnetwork))/,r=/^(psns\:browse)/,s=/^(https?\:)?(\/{2})(direct\.(playstation|sonyentertainmentnetwork))/,d=function(e){return"string"==typeof e&&(o.test(e)||r.test(e))},c=function(e){return e&&s.test(e)},l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),p=function(){function e(){l(this,e),this.bannerImpressionTimeout=500,this.BANNER_SELECTORS={mobileContent:".page-banner__content-wrapper\\@mobile .page-banner__content",desktopContent:".page-banner__content-wrapper:not(.page-banner__content-wrapper\\@mobile) .page-banner__content",desktopLogoContent:".page-banner__content-wrapper:not(.page-banner__content-wrapper\\@mobile) .page-banner__logo-content"}}return h(e,[{key:"trackBannerEvent",value:function(e,t,n,o){var r=n.data("module-name")||"pagebanner";return _gpdc.analytics.event.addGDLEvent(t,""+e+("click"===t?r:""),{userActionFlag:!1,moduleName:r,label:i.EMPTY_LABEL,position:n.data("analytics-position"),linkUrl:o||i.EMPTY_LABEL,assetName:n.data("analytics-asset")||i.EMPTY_LABEL,elementType:n.data("media-type-"+(a.IS_TABLET?"tablet":"mobile"))||"image"},n),Promise.resolve()}},{key:"setAnalyticsAttrs",value:function(e,t,n,a){var i=e.find(".media-block--bg"),o=i.hasClass("+inline-video");t.data("analytics-position",a+1),t.data("module-name",n?_gpdc.config.templateName+" hero banner":"pagebanner"),t.data("media-type-mobile",o&&!i.hasClass("+inline-video--none")&&"video"||"image"),t.data("media-type-tablet",o&&!i.hasClass("+inline-video--none@tablet")&&"video"||"image")}},{key:"onBannerClick",value:function(e){e.preventDefault();var t=$(e.target),n=$(e.currentTarget);if(!t.length||!t.hasClass("icon")&&!t.closest(".media-block__overlay").length){var a=n.attr("href")||"";this.trackBannerEvent("select ","click",n,a).then(function(){a&&setTimeout(function(){return window.location.href=a},350)})}}},{key:"addWaypointAnimation",value:function(e,t){var n=this,a=e.data("bg-animation")||"",i=e.data("content-animation")||"",o=e.hasClass("+logo--none"),r=new Waypoint({element:e.get(0),handler:function(){setTimeout(function(){return n.trackBannerEvent("banner impression","impression",t,t.attr("href"))},n.bannerImpressionTimeout),n.bannerImpressionTimeout=0,r.destroy()},offset:"20%"});if(a)var s=new Waypoint({element:e.get(0),handler:function(){e.addClass(a),s.destroy()},offset:"90%"});if(i){var d=e.find(this.BANNER_SELECTORS.mobileContent),c=e.find(this.BANNER_SELECTORS.desktopContent);if(d&&d.length)var l=o||e.hasClass("+logo@mobile--none"),h=new Waypoint({element:d.get(0),handler:function(){$(h.element).is(":visible")&&(e.addClass(i),h.destroy())},offset:l?"75%":"60%"});if(c&&c.length)var p=o||e.hasClass("+logo@desktop--none"),m=new Waypoint({element:c.get(0),handler:function(){$(m.element).is(":visible")&&(e.addClass(i),m.destroy())},offset:p?"75%":"50%"})}}},{key:"setZIndexForProductBanners",value:function(e,t){e.hasClass("page-banner--featured")&&e.attr("class").indexOf("+feature-overflow--bo")>-1&&e.css("z-index",t+2)}},{key:"setBannerContentWidthDesktop",value:function(e){var t=e.find(".page-banner__content-wrapper .page-banner__logo"),n=e.find(".page-banner__feature"),a=n.length&&n.outerHeight()||null,i=0;if(t&&t.length||e.hasClass("hp-hero__banner")){try{i=e.find(this.BANNER_SELECTORS.desktopLogoContent).actual("outerHeight")}catch(t){i=e.find(this.BANNER_SELECTORS.desktopLogoContent).outerHeight(),_gpdc.Logger.log("jQuery Actual not found! falling back to outerHeight()")}e.css("--banner-content-calc-height",i+"px")}a&&n.css("--banner-feature-calc-height",a+"px")}},{key:"setupContentHeightCalculator",value:function(e){var t=this;_gpdc.elements.$window.on("resize.dkPageBannerComponent",function(){$.each(e,function(e,n){return t.setBannerContentWidthDesktop($(n))})})}},{key:"processPageBanners",value:function(e){var t=this;$.each(e,function(e,a){var i=$(a),o=i.hasClass("hp-hero__banner"),r=i.find(".page-banner__keyart-anchor");n(i,"banner-theme","--custom-banner-theme",!0,!1,!0);var s=r.attr("href")||"";if(s&&(d(s)||c(s))&&r.attr("href",_gpdc.analytics.commerce.appendCIDs(s,r.get(0),"pagebanner")),o){var l=i.data("bg-animation")||"",h=i.data("content-animation")||"";i.addClass(l+" "+h)}else t.addWaypointAnimation(i,r);t.setBannerContentWidthDesktop(i),t.setZIndexForProductBanners(i,e),t.setAnalyticsAttrs(i,r,o,e),r.on("click.dkPageBannerComponent",t.onBannerClick.bind(t))}),this.setupContentHeightCalculator(e)}},{key:"init",value:function(){var e=$('[data-component="page-banner"]');return!(!e||!e.length)&&(this.processPageBanners(e),void _gpdc.Logger.log("PageBanner Component initialized!!"))}}]),e}(),m=function(){function e(){var t=this;l(this,e),window._gpdc&&_gpdc.user&&"undefined"!=typeof _gpdc.user.isLoggedIn?this.initModules():_gpdc.elements.$document.one("userInfoSet.dkComponents",function(){return t.initModules()})}return h(e,[{key:"initModules",value:function(){_gpdc.Logger.groupStart("Components");var e=new p;e.init(),_gpdc.Logger.groupEnd()}}]),e}();!function(e){_gpdc.elements.$document.ready(function(){_gpdc.Logger.groupStart("Banners");new m;_gpdc.Logger.groupEnd()})}(jQuery)}();
