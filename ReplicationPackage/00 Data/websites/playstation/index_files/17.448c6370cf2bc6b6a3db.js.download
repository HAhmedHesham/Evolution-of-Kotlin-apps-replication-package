(window.pswCommerceAnywhere=window.pswCommerceAnywhere||[]).push([[17],{264:function(e,t,r){"use strict";r.r(t);var n=r(15),a=r.n(n),o=r(22),i=r.n(o),c=r(1),s=r.n(c),u=r(2),l=r.n(u),p=r(20),d=r.n(p),m=r(21),f=r.n(m),h=r(14),w=r.n(h),g=r(0),v=r(257),y=r(11),_=r(53),C=r(59),b=r(99),I=r(82);function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=w()(e);if(t){var a=w()(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return f()(this,r)}}var k=function(e){d()(r,e);var t=O(r);function r(){return s()(this,r),t.apply(this,arguments)}return l()(r,[{key:"render",value:function(){var e=this.props,t=e.onClose,r=e.qa,n=e.format,a=e.onReload;return g.g.createElement("div",{"data-qa":r},g.g.createElement("div",{className:Object(y.b)("psw-l-line-repel","psw-m-m")},g.g.createElement("h2",{"data-qa":"".concat(r,"#header#title")},n("string","msgid_cart")),g.g.createElement(C.a,{variant:"content",onClick:t,qa:"".concat(r,"#header#close"),className:"psw-top-left",ariaLabel:n("string","msgid_sr_close_dialog")},g.g.createElement(b.a,{type:"close",size:"l"}))),g.g.createElement("div",{className:Object(y.b)("psw-l-stack-center","psw-l-line-center","psw-m-x-l","psw-fill-y","psw-m-t-3xl")},g.g.createElement(I.a,{className:"psw-m-b-s psw-m-t-3xl",namespace:"ps-illustration",type:"error-general-fail",qa:"".concat(r,"#details#image")}),g.g.createElement("span",{className:"psw-h3 psw-m-b-s","data-qa":"".concat(r,"#details#primary")},n("string","msgid_well_didn_work")),g.g.createElement("span",{className:"psw-h6 psw-l-line-center psw-m-b-s","data-qa":"".concat(r,"#details#secondary")},n("string","msgid_we_were_unable_load")),g.g.createElement(C.a,{onClick:a,ariaLabel:n("string","msgid_try_again"),qa:"".concat(r,"#details#tryAgain"),className:"psw-c-accent-1 psw-c-interactive",variant:"content"},g.g.createElement("span",{"data-qa":"".concat(r,"#details#tryAgain#label")},n("string","msgid_try_again")))))}}]),r}(g.d);k.defaultProps={qa:"mfe-cart-error",onClose:function(){},format:function(){},onReload:function(){}};var S=k;function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=w()(e);if(t){var a=w()(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return f()(this,r)}}var A=function(e){d()(r,e);var t=E(r);function r(){return s()(this,r),t.apply(this,arguments)}return l()(r,[{key:"render",value:function(){var e=this.props,t=e.src,r=e.name,n=e.isOpen,a=e.onClose,o=e.open,i=e.openOnMount,c=e.isCartLoading,s=e.shouldShowErrorScreen,u=e.format,l=e.onReload;return g.g.createElement(v.a,{className:"psw-light-theme",openOnMount:i,isOpen:n,onClose:a,onOpen:o},!c&&s&&g.g.createElement(S,{onClose:a,format:u,onReload:l}),c&&g.g.createElement("span",{className:Object(y.b)("psw-center","psw-m-r-m","psw-clip")},g.g.createElement(_.a,{className:"psw-spin",src:"loading-circle-dark.png",useStatic:!0,place:"center",fit:"cover",width:50,aspectRatio:"1:1"})),g.g.createElement("iframe",{"aria-hidden":!n,className:Object(y.b)("psw-fill",{"psw-hide":s}),style:{visibility:c?"hidden":"visible"},title:u("string","msgid_cart_web_checkout"),name:r,src:t,frameBorder:0}))}}]),r}(g.d);A.defaultProps={src:"",isOpen:!1,onClose:function(){},open:function(){},openOnMount:!1,isCartLoading:!0,shouldShowErrorScreen:!1,format:function(){},onReload:function(){}};var P=A,j=r(75),R=r.n(j),L=r(5),D=r.n(L),T=r(241),U=["checkout_cart_cancel","checkout_continue_shopping","checkout_thankyou_dismiss","transact_action_completed","checkout_error_dismiss"],N=[],M=["checkout_signin_required","checkout_password_verification_required"],q=function(){function e(t){var r=this,n=t.name,a=t.clientId,o=t.origin,i=t.loadTimeout,c=t.enableUpsellFlow;s()(this,e),D()(this,"on",(function(){var e;return(e=r._observer).on.apply(e,arguments)})),D()(this,"off",(function(){var e;return(e=r._observer).off.apply(e,arguments)})),D()(this,"startCartLoadTimer",(function(){r.cartLoadTimer=setTimeout((function(){r._observer.emit("showCartError")}),r.loadTimeout)})),D()(this,"clearCartLoadTimer",(function(){return clearTimeout(r.cartLoadTimer)})),D()(this,"_makeNonce",(function(){return Math.round(1e4*Math.random())})),D()(this,"_makeUrl",(function(e){var t=e.route,n=e.queryParams,a=e.addNonce,o=["clientId=".concat(encodeURIComponent(r.clientId))],i=a?["nonce=".concat(r._makeNonce())]:[],c="?".concat(o.concat(n,i).join("&"));return"".concat(r.origin,"/").concat(t).concat(c)})),D()(this,"_makeUrlForPurchase",(function(e){var t=e.type,n=e.skuId,a=e.prologueEmsAlias,o=e.rewardId,i=e.upSellService,c="PS_NOW"===i||"EA_ACCESS"===i;"buynow"===t.toLowerCase()&&"PS_PLUS"===i&&(c=!0);var s=/^(ea|now)--/.test(a),u=c?"subscribe":"".concat(t,"/").concat(n),l=[];return o&&l.push("rewardId=".concat(encodeURIComponent(o))),r.enableUpsellFlow&&(c?l=l.concat("upsell-type=subscribe","emsId=".concat(a)):a&&!s&&l.push("upsell-type=service_".concat(a))),r._makeUrl({route:u,queryParams:l,addNonce:!0})})),D()(this,"_makeUrlForCart",(function(e){return r._makeUrl({route:"cart",queryParams:e?["transact-action=".concat(e)]:[],addNonce:!0})})),D()(this,"_parseMessage",(function(e){var t=(e||{}).data;if(!t)return{};if("object"===R()(t))return t;try{var r=JSON.parse(t);return{nonce:r.nonce,action:r.action,data:r.data}}catch(e){return console.error("json parse error",e),{}}})),D()(this,"_handleMessage",(function(e){if(e.origin===r.origin){var t=r._parseMessage(e),n=t.action,a=t.data;if("checkout_purchase_complete"===n&&r._observer.emit("purchaseComplete",{orderId:a.orderId}),"checkout_item_added"===n&&r._observer.emit("itemAddedToCart",{numItemsInCart:a.numItemsInCart,productId:a.productId,skuId:a.skuId}),"checkout_app_visible"===n&&r._observer.emit("cartVisible"),"checkout_error_visible"===n&&r._observer.emit("errorInCart",{cartAction:a.cartAction,skuId:a.skuId,productId:a.productId}),"checkout_item_removed"===n&&r._observer.emit("itemRemovedFromCart",{numItemsInCart:a.numItemsInCart,productId:a.productId,skuId:a.skuId}),"checkout_redirect_to_game_library"===n){var o=a.gameLibraryUrl;o&&window.open(o,"_self")}if(U.includes(n)&&r._observer.emit("closeCart"),N.includes(n)&&r.reload(),M.includes(n)){var i={redirectUri:a.cartRedirectUri,flow:"checkout_password_verification_required"===n?"web:walletAdmin":""};r._observer.emit("authRequired",i)}}})),this.name=n,this.clientId=a,this.origin=o,this.loadTimeout=i,this.enableUpsellFlow=c,this._observer=new T.a({name:this.name,events:["closeCart","authRequired","purchaseComplete","itemAddedToCart","itemRemovedFromCart","cartVisible","errorInCart","showCartError"]})}return l()(e,[{key:"init",value:function(){"undefined"==typeof window||window.hasMessageHandler||(window.addEventListener("message",this._handleMessage),window.hasMessageHandler=!0)}},{key:"destroy",value:function(){window.removeEventListener("message",this._handleMessage),window.hasMessageHandler=!1,this.off()}},{key:"makeUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.skuId,n=t.prologueEmsAlias,a=t.rewardId,o=t.transactAction,i=t.upSellService,c=/^(add|buynow)$/i.test(e);return c?this._makeUrlForPurchase({type:e,rewardId:a,skuId:r,prologueEmsAlias:n,upSellService:i}):this._makeUrlForCart(o)}},{key:"getCartIframe",value:function(){return document.querySelector('iframe[name="'.concat(this.name,'"]'))}},{key:"reload",value:function(){var e=this.getCartIframe()||{};e.src=e.src}}]),e}();function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var F=function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){D()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},{cart:{make:function(e){return{ui:"CartDrawer",layer:"drawer",scrim:"top",persist:!0,name:e.name,src:e.src,openOnMount:e.openOnMount,actions:{onReload:e.onReload}}}}})};function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var H=function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){D()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},F())},K=r(78),V=r(258);function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=w()(e);if(t){var a=w()(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return f()(this,r)}}var W=function(e){d()(r,e);var t=G(r);function r(){return s()(this,r),t.apply(this,arguments)}return l()(r,[{key:"render",value:function(){return g.g.createElement("div",{className:"psw-full-screen psw-pointer-events-off"},g.g.createElement(V.a,{className:"psw-bottom-left psw-pointer-events-on",force:!1,disableFixedTop:!0}))}}]),r}(g.d);function z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var J=function(){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?z(Object(r),!0).forEach((function(t){D()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},{gdprConsent:{make:function(){return{ui:"GdprConsent",layer:"notification",persist:!0}}}})},Y=r(260),$=function(e){var t=e.app,r=e.theme,n=document.createElement("div");n.id="psw-layers",n.classList.add("psw-root"),n.classList.add("psw-".concat(r,"-theme")),n.classList.add("psw-layer"),n.classList.add("psw-pointer-events-off"),n.classList.add("psw-allow-scroll"),document.body.appendChild(n),g.g.render(g.g.createElement(Y.a,{format:t.i18n.format,getComponent:t.getComponent,layers:t.layers.getLayers()}),n)},Q=r(129);t.default=function(e){var t=e.app,r=e.theme;($({app:t,theme:r}),function(e){var t=e.app;return{name:"cart",_openParams:{},_stateKeys:["cartAction","skuId","prologueEmsAlias","transactAction","upSellService"],_bootstrapCartClient:function(){var e=this;this._cartClient=new q({name:t.config.get("client.webCheckout.name"),clientId:t.config.get("client.webCheckout.clientId"),origin:t.config.get("client.webCheckout.origin"),loadTimeout:t.config.get("client.webCheckout.loadTimeout"),enableUpsellFlow:t.config.get("feature.enableUpsellCtas")}),this._cartClient.init(),this._cartClient.on("purchaseComplete",(function(e){t.emit("cartItemCountUpdate",{numItemsInCart:0},{isPublic:!0}),t.emit("purchaseComplete",e)})),this._cartClient.on("itemAddedToCart",(function(e){t.emit("cartItemCountUpdate",e,{isPublic:!0}),t.emit("itemAddedToCart",e)})),this._cartClient.on("errorInCart",(function(e){return t.emit("errorInCart",e)})),this._cartClient.on("itemRemovedFromCart",(function(e){t.emit("cartItemCountUpdate",e,{isPublic:!0}),t.emit("itemRemovedFromCart",e)})),this._cartClient.on("closeCart",(function(){return e.close()})),this._cartClient.on("authRequired",(function(t){return e._signIn(t)})),this._cartClient.on("cartVisible",(function(){e._cartClient.clearCartLoadTimer(),e._cartDrawer.update({isCartLoading:!1})})),this._cartClient.on("showCartError",(function(){e._cartDrawer.update({isCartLoading:!1,shouldShowErrorScreen:!0})}))},_signIn:function(e){var r=this;return i()(a.a.mark((function n(){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return K.b.setItems(r._openParams),n.next=3,t.session.signIn(e);case 3:case"end":return n.stop()}}),n)})))()},_bootstrapAndOpenCartDrawer:function(e){var r=this,n=e.src;this._cartDrawer=t.layers.initItem({type:"cart",name:this._cartClient.name,openOnMount:!0,isCartLoading:!0,shouldShowErrorScreen:!1,src:n,onReload:function(){return r.reload()}}),this._cartDrawer.on("close",(function(e){t.emit("clickAwayCloseCart",e)}))},reload:function(){this._cartClient.reload(),this._cartClient.startCartLoadTimer(),this._cartDrawer.update({isCartLoading:!0,shouldShowErrorScreen:!1})},open:function(e){var r=this;return i()(a.a.mark((function n(){var o,i,c,s,u,l,p,d,m;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=e.type,i=e.skuId,c=e.rewardId,s=e.prologueEmsAlias,u=e.transactAction,l=e.upSellService,p=e.telemetryMeta,r._openParams={cartAction:o,skuId:i,rewardId:c,prologueEmsAlias:s,transactAction:u,upSellService:l},t.session.isUserSignedIn()){n.next=6;break}return n.next=5,r._signIn();case 5:return n.abrupt("return");case 6:return r._cartClient||r._bootstrapCartClient(),d=r._cartClient.makeUrl(o,{skuId:i,prologueEmsAlias:s,rewardId:c,transactAction:u,upSellService:l}),n.next=10,t.telemetry.appendSmcid(d,p);case 10:m=n.sent,r._cartClient.startCartLoadTimer(),r._cartDrawer?(r._cartDrawer.update({src:m,isCartLoading:!0}),r._cartDrawer.open()):r._bootstrapAndOpenCartDrawer({src:m});case 13:case"end":return n.stop()}}),n)})))()},close:function(){this._openParams={},this._cartDrawer.close({delay:400})},_restoreCartAfterSignIn:function(){var e=this;return i()(a.a.mark((function t(){var r,n,o,i,c,s;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=K.b.getItems(e._stateKeys),n=r.cartAction,o=r.skuId,i=r.prologueEmsAlias,c=r.transactAction,s=r.upSellService,!n){t.next=5;break}return t.next=4,e.open({type:n,skuId:o,prologueEmsAlias:i,transactAction:c,upSellService:s});case 4:K.b.removeItems(e._stateKeys);case 5:case"end":return t.stop()}}),t)})))()},init:function(){var e=this;return i()(a.a.mark((function r(){return a.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.addComponent("CartDrawer",P),t.layers.addLayerItemTypes(H()),r.next=4,e._restoreCartAfterSignIn();case 4:e.removeAddToCartListener=t.on("ADD_TO_CART",(function(t){var r=t.skuId,n=t.prologueEmsAlias,a=t.rewardId,o=t.upSellService,i=t.telemetryMeta,c=void 0===i?{}:i;e.open({type:"add",skuId:r,rewardId:a,prologueEmsAlias:n,telemetryMeta:c,upSellService:o})})),e.removeBuyNowListener=t.on("BUY_NOW",(function(t){var r=t.skuId,n=t.prologueEmsAlias,a=t.upSellService,o=t.telemetryMeta,i=void 0===o?{}:o;e.open({type:"buynow",skuId:r,prologueEmsAlias:n,telemetryMeta:i,upSellService:a})})),e.removeOpenCartListener=t.on("OPEN_CART",(function(t){var r=t.transactAction,n=t.telemetryMeta,a=void 0===n?{}:n;e.open({type:"view",transactAction:r,telemetryMeta:a})}));case 7:case"end":return r.stop()}}),r)})))()},destroy:function(){this._cartDrawer.destroy(),this._cartClient.destroy(),this.removeAddToCartListener(),this.removeBuyNowListener(),this.removeOpenCartListener()}}}({app:t}).init(),Object(Q.a)())||function(e){var t=e.app;return{name:"gdprConsent",init:function(){V.a.configure({instance:t.gdpr}),t.addComponent("GdprConsent",W),t.layers.addLayerItemTypes(J()),this._gdprConsentPrompt=t.layers.initItem({type:"gdprConsent"}),this._gdprConsentPrompt.open()},destroy:function(){this._gdprConsentPrompt.close()}}}({app:t}).init()}}}]);