!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n=n||self).Perfume=e()}(this,(function(){"use strict";var n={t:!1,i:!1,o:3e4},e=window,t=e.console,i=document,r=e.navigator,o=e.performance,u=function(){return r.deviceMemory},c=function(){return r.hardwareConcurrency},f=function(){return o&&!!o.getEntriesByType&&!!o.now&&!!o.mark},a="4g",s=!1,l=function(){return!!(c()&&c()<=4)||!!(u()&&u()<=4)},m=function(n,e){switch(n){case"slow-2g":case"2g":case"3g":return!0;default:return l()||e}},d={u:!1},v=function(n){i.hidden&&(n(),d.u=i.hidden)},p=function(n){return parseFloat(n.toFixed(4))},g=function(n){return"number"!=typeof n?null:p(n/Math.pow(1024,2))},y=[2e3,4e3],h=[2500,4e3],b=[.1,.25],k={ttfb:[200,500],fp:y,fcp:y,lcp:h,lcpFinal:h,fid:[100,300],cls:b,clsFinal:b,tbt:[300,600]},T=function(n,e){return k[n]?e<=k[n][0]?"good":e<=k[n][1]?"needsImprovement":"poor":null},w=function(t,i,o){var f;f=function(){d.u&&t.indexOf("Final")<0||!n.analyticsTracker||n.analyticsTracker({metricName:t,data:i,eventProperties:o||{},navigatorInformation:r?{deviceMemory:u()||0,hardwareConcurrency:c()||0,serviceWorkerStatus:"serviceWorker"in r?r.serviceWorker.controller?"controlled":"supported":"unsupported",isLowEndDevice:l(),isLowEndExperience:m(a,s)}:{},vitalsScore:T(t,i)})},"requestIdleCallback"in e?e.requestIdleCallback(f,{timeout:3e3}):f()},_=function(n,e,t){Object.keys(e).forEach((function(n){"number"==typeof e[n]&&(e[n]=p(e[n]))})),w(n,e,t)},F=function(e,t,i){var r=p(e);r<=n.o&&r>=0&&w(t,r,i)},E={},x={value:0},j={value:0},D={value:0},I={value:{beacon:0,css:0,fetch:0,img:0,other:0,script:0,total:0,xmlhttprequest:0}},P={value:0},q=function(n){var e=n.pop();e&&!e.s&&e.value&&(x.value+=e.value)},C={},L=function(n,e){try{var i=new PerformanceObserver((function(n){e(n.getEntries())}));return i.observe({type:n,buffered:!0}),i}catch(n){t.warn("Perfume.js:",n)}return null},O=function(n){C[n]&&C[n].disconnect(),delete C[n]},S=function(n){var e=n.pop();e&&F(e.processingStart-e.startTime,"fid",{performanceEntry:e}),O(1),F(D.value,"lcp"),C[3]&&"function"==typeof C[3].takeRecords&&C[3].takeRecords(),F(x.value,"cls"),setTimeout((function(){F(P.value,"tbt"),_("dataConsumption",I.value)}),1e4)},W=function(n){n.forEach((function(n){if(!("self"!==n.name||n.startTime<j.value)){var e=n.duration-50;e>0&&(P.value+=e)}}))},B=function(n){n.forEach((function(n){"first-paint"===n.name?F(n.startTime,"fp"):"first-contentful-paint"===n.name&&(j.value=n.startTime,F(j.value,"fcp"),C[4]=L("longtask",W),O(0))}))},M=function(n){var e=n.pop();e&&(D.value=e.renderTime||e.loadTime)},z=function(n){n.forEach((function(n){n.identifier&&F(n.startTime,n.identifier)}))},H=function(e){e.forEach((function(e){if(n.t&&_("resourceTiming",e),e.decodedBodySize&&e.initiatorType){var t=e.decodedBodySize/1e3;I.value[e.initiatorType]+=t,I.value.total+=t}}))},N=function(){C[2]&&(F(D.value,"lcpFinal"),O(2)),C[3]&&("function"==typeof C[3].takeRecords&&C[3].takeRecords(),F(x.value,"clsFinal"),O(3))},R=function(n){var e="usageDetails"in n?n.usageDetails:{};_("storageEstimate",{quota:g(n.quota),usage:g(n.usage),caches:g(e.caches),indexedDB:g(e.indexedDB),serviceWorker:g(e.serviceWorkerRegistrations)})};return function(){function t(t){if(void 0===t&&(t={}),this.l="6.2.0",n.analyticsTracker=t.analyticsTracker,n.t=!!t.resourceTiming,n.i=!!t.elementTiming,n.o=t.maxMeasureTime||n.o,f()){"PerformanceObserver"in e&&(C[0]=L("paint",B),C[1]=L("first-input",S),C[2]=L("largest-contentful-paint",M),n.t&&L("resource",H),C[3]=L("layout-shift",q),n.i&&L("element",z)),void 0!==i.hidden&&i.addEventListener("visibilitychange",v.bind(this,N));var u=function(){if(!f())return{};var n=o.getEntriesByType("navigation")[0];if(!n)return{};var e=n.responseStart,t=n.responseEnd;return{fetchTime:t-n.fetchStart,workerTime:n.workerStart>0?t-n.workerStart:0,totalTime:t-n.requestStart,downloadTime:t-e,timeToFirstByte:e-n.requestStart,headerSize:n.transferSize-n.encodedBodySize||0,dnsLookupTime:n.domainLookupEnd-n.domainLookupStart}}();_("navigationTiming",u),u.timeToFirstByte&&F(u.timeToFirstByte,"ttfb"),_("networkInformation",function(){if("connection"in r){var n=r.connection;return"object"!=typeof n?{}:(a=n.effectiveType,s=!!n.saveData,{downlink:n.downlink,effectiveType:n.effectiveType,rtt:n.rtt,saveData:!!n.saveData})}return{}}()),r&&r.storage&&"function"==typeof r.storage.estimate&&r.storage.estimate().then(R)}}return t.prototype.start=function(n){f()&&!E[n]&&(E[n]=!0,o.mark("mark_"+n+"_start"),d.u=!1)},t.prototype.end=function(n,e){void 0===e&&(e={}),f()&&E[n]&&(o.mark("mark_"+n+"_end"),delete E[n],_(n,p(function(n){o.measure(n,"mark_"+n+"_start","mark_"+n+"_end");var e=o.getEntriesByName(n).pop();return e&&"measure"===e.entryType?e.duration:-1}(n)),e))},t.prototype.endPaint=function(n,e){var t=this;setTimeout((function(){t.end(n,e)}))},t.prototype.clear=function(n){delete E[n],o.clearMarks&&(o.clearMarks("mark_"+n+"_start"),o.clearMarks("mark_"+n+"_end"))},t}()}));
//# sourceMappingURL=perfume.umd.min.js.map
